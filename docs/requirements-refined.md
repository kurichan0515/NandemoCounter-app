# なんでもカウンターアプリ 要件定義書（整理版）

## 1. 概要

### 1.1 アプリの目的
ユーザーが何でも数えて記録できるシンプルなカウンターアプリ。会員登録なしで即座に利用開始できる。

### 1.2 主要機能
- **タグ機能**: カテゴリ分類による柔軟な記録管理
- **カウント機能**: ボタン操作と直接入力の2種類の入力方法
- **記録機能**: 何を、いつ、どこで（オプション）を記録
- **分析機能**: タグ・期間別の統計とグラフ表示
- **当日登録中心UI**: スムーズな記録入力体験
- **広告機能**: 収益化のための広告表示

## 2. 用語定義

- **カウンター（Counter）**: 数を数えるための単位。例：「コーヒーを飲んだ回数」「歩数」など
- **タグ（Tag）**: カウント記録を分類するためのラベル。1つの記録に複数のタグを付与可能
- **記録（CountRecord）**: カウント操作のたびに保存される履歴データ
- **デバイスID**: アプリが自動生成するデバイス固有の識別子（UUID形式）
- **当日登録**: デフォルトで当日の日時が設定される登録方法
- **過去入力**: 日時を変更して過去の日付で記録を入力する機能

## 3. 機能要件

### 3.1 認証・ユーザー管理

#### 3.1.1 会員登録なしでの利用
- **必須要件**: アプリ起動時に即座に利用開始できる
- **実装方針**: 
  - デバイス固有のID（UUID）を自動生成してローカルに保存
  - 初回起動時にデバイスIDを生成し、以降はそのIDを使用
  - ユーザーは認証フローを経由せずに利用可能

#### 3.1.2 データの保存先
- **ローカル優先**: デバイス内のストレージ（AsyncStorage）に保存
- **オプション**: 将来的にクラウド同期機能を追加する可能性を考慮した設計

### 3.2 タグ機能

#### 3.2.1 タグの作成・管理
- 複数のタグを作成可能
- タグに名前と色を設定可能
- タグの編集・削除機能
- タグの一覧表示（頻度順・名前順・作成日順でソート可能）

#### 3.2.2 タグの付与
- 1つのカウント記録に複数のタグを付与可能
- カウント登録時にタグを選択・追加できる
- 既存の記録にも後からタグを追加・削除可能

#### 3.2.3 タグによる分析
- タグごとの集計表示（いつ、何を、どれだけ）
- タグ別の統計情報（合計、平均、期間別集計）
- タグの組み合わせでの分析（複数タグが付いた記録の抽出）
- 頻度の高いタグを優先表示

### 3.3 カウンター機能

#### 3.3.1 カウンターの作成・管理
- 複数のカウンターを作成可能
- 各カウンターに名前と説明（オプション）を設定可能
- カウンターの編集・削除機能
- **注意**: カウンターの現在値（currentCount）は記録から自動計算される

#### 3.3.2 カウント入力方法
**2種類の入力方法を提供**:

1. **ボタン操作**
   - カウントの増加（+1）
   - カウントの減少（-1）
   - リセットボタン（0に戻す）

2. **直接入力**
   - 数値キーボードで直接数値を入力
   - 入力値の検証（負の値の扱いなど）
   - 入力確定ボタン

### 3.4 記録機能

#### 3.4.1 記録する情報
各カウント操作時に以下の情報を記録：

1. **何を数えたか（What）**
   - カウンターIDとカウンター名（記録時点のスナップショット）
   - 付与されたタグ（複数可）

2. **いつ数えたか（When）**
   - カウント操作の日時（ISO8601形式のタイムスタンプ）
   - デフォルトは現在日時、過去入力も可能

3. **どこで数えたか（Where）**（オプション）
   - GPS位置情報（ユーザーの許可時のみ）
   - 位置情報が取得できない場合は記録しない

4. **その他**
   - 入力方法（ボタン操作 or 直接入力）
   - デバイスID

#### 3.4.2 記録の保存形式
```typescript
interface CountRecord {
  id: string;                    // 記録ID（UUID）
  counterId: string;             // カウンターID
  counterName: string;           // カウンター名（記録時点のスナップショット）
  count: number;                 // カウント値（増減量、直接入力値）
  timestamp: string;             // ISO8601形式の日時
  tags: string[];                // タグIDの配列
  location?: {                   // 位置情報（オプション）
    latitude: number;
    longitude: number;
    address?: string;            // 逆ジオコーディング結果（オプション）
  };
  deviceId: string;             // デバイスID
  inputMethod: 'button' | 'direct'; // 入力方法
}
```

#### 3.4.3 記録のタイミングとUI
- **記録のタイミング**: カウント操作（+/-/直接入力/リセット）のたびに記録を作成
- **当日登録中心のUI**: デフォルトで当日の日時が設定される
- **過去入力機能**: 日時を変更して過去の記録も入力可能
- **記録の編集・削除**: 既存の記録を編集・削除可能

### 3.5 履歴閲覧機能

#### 3.5.1 記録履歴の表示
- カウンターごとの履歴一覧表示
- タグごとの履歴一覧表示
- 日時順（新しい順/古い順）でソート可能
- 日付ごとにグループ化表示

#### 3.5.2 履歴の詳細表示
- 記録日時
- カウント値
- 付与されたタグ（複数表示）
- 位置情報（取得済みの場合、地図表示も検討）
- 編集・削除ボタン

#### 3.5.3 履歴の検索・フィルタ
- 日付範囲でのフィルタ
- カウンター名での検索
- タグでのフィルタ（単一タグ・複数タグ、AND/OR条件）
- 位置情報でのフィルタ（オプション）

### 3.6 分析機能

#### 3.6.1 タグ選択機能
- タグ一覧から分析対象を選択
- **頻度の高いタグを優先表示**
  - 記録に使用された回数が多い順にソート（デフォルト）
  - 最近使用されたタグも考慮（重み付け）
  - ソートオプション：頻度順、名前順、作成日順
- 複数タグの選択と比較分析
- 選択状態の視覚的フィードバック

#### 3.6.2 カレンダー表示
- 月間カレンダーで記録の可視化
- 選択されたタグの記録がある日を視覚的に表示
- 複数タグ選択時は色分け表示
- 日付タップで詳細表示
- カレンダー上で期間範囲選択可能

#### 3.6.3 期間選択
- **プリセット期間**:
  - 月累計（現在の月の1日から今日まで）
  - 3か月（過去3か月間）
  - 6か月（過去6か月間）
  - 12か月（過去12か月間）
- **カスタム期間**: 開始日・終了日を指定

#### 3.6.4 統計情報
- 選択期間の合計カウント
- 平均カウント（日別平均）
- 最大カウント日
- 記録日数
- 選択されたタグ別の集計情報
- 複数タグ選択時は比較統計情報

#### 3.6.5 グラフ表示
- 選択されたタグに応じたグラフ表示
- 期間に応じた最適なグラフ表示
  - **月累計・3か月**: 日別集計グラフ（棒グラフ）
  - **6か月**: 週別集計グラフ（折れ線グラフ）
  - **12か月**: 月別集計グラフ（折れ線グラフ）
- タグ別の色分け表示
- 複数タグ選択時は比較表示
- インタラクティブな操作（タップで詳細表示など）

### 3.7 広告機能

#### 3.7.1 広告の種類
1. **登録完了時の広告**
   - カウント記録を保存した際に表示
   - インタースティシャル広告
   - 表示頻度制御（例：3回に1回）
   - スキップ可能（数秒後に閉じる）

2. **バナー広告**
   - アプリ内の適切な位置に常時表示
   - 画面下部に配置
   - スクロール時も追従

#### 3.7.2 広告の実装
- Expo AdMobまたはGoogle Mobile Ads SDKを使用
- 広告の表示頻度制御（過度な表示を避ける）
- プライバシーポリシーへの対応

## 4. UI/UX要件

### 4.1 画面構成

#### 4.1.1 メイン画面（今日の記録）
- **目的**: 当日の記録を中心とした操作画面
- **表示内容**:
  - 今日の日付表示
  - カウンター一覧（またはタグ一覧）
  - 各カウンターの現在値（記録から計算）
- **操作**:
  - 新しいカウント登録ボタン
  - カウンター詳細への遷移
  - 過去入力への切り替えボタン
- **広告**: バナー広告を下部に表示

#### 4.1.2 カウント登録画面
- **目的**: 新しいカウント記録を作成
- **入力項目**:
  - カウンター選択（必須）
  - カウント値（ボタン操作 or 直接入力）
  - 日時設定（デフォルト：現在日時、過去入力可能）
  - タグ選択（複数選択可能）
  - 位置情報（オプション、許可時のみ）
- **操作**:
  - 入力方法の切り替え（ボタン/直接入力）
  - 登録ボタン（登録完了時に広告表示）

#### 4.1.3 カウンター詳細画面
- **目的**: 特定のカウンターの操作と履歴表示
- **表示内容**:
  - カウンター名と説明
  - 現在のカウント値（記録から計算）
  - カウント操作UI（ボタン操作 or 直接入力）
- **操作**:
  - カウント操作（+/-/リセット or 直接入力）
  - 履歴表示への遷移
  - タグ分析への遷移
  - カウンター編集・削除

#### 4.1.4 履歴画面
- **目的**: 記録履歴の閲覧と管理
- **表示内容**:
  - 記録一覧（日付ごとにグループ化）
  - 各記録の詳細情報
- **操作**:
  - ソート機能（日時順）
  - フィルタ機能（タグ、日付範囲）
  - 記録の編集・削除

#### 4.1.5 タグ分析画面
- **目的**: タグ別の統計と分析
- **構成**:
  1. **タグ選択画面**: 頻度順でタグ一覧を表示、分析対象を選択
  2. **分析結果画面**: 選択されたタグの分析結果を表示
- **表示内容**:
  - カレンダー表示（記録日のハイライト）
  - 期間選択UI
  - 統計情報
  - グラフ表示
  - 記録一覧

### 4.2 UI/UX原則
- **当日登録中心**: デフォルトで当日の日時が設定される
- **シンプルな操作**: 最小限のタップで記録できる
- **視覚的フィードバック**: 操作結果がすぐに反映される
- **一貫性**: 画面間で操作感が統一されている

## 5. データモデル

### 5.1 タグ
```typescript
interface Tag {
  id: string;                    // タグID（UUID）
  name: string;                  // タグ名
  color: string;                 // タグの色（HEXコード）
  createdAt: string;             // 作成日時（ISO8601）
  deviceId: string;             // デバイスID
}
```

### 5.2 カウンター
```typescript
interface Counter {
  id: string;                    // カウンターID（UUID）
  name: string;                  // カウンター名
  description?: string;          // 説明（オプション）
  createdAt: string;             // 作成日時（ISO8601）
  updatedAt: string;             // 更新日時（ISO8601）
  deviceId: string;             // デバイスID
  // 注意: currentCountは記録から計算されるため、保存しない
}
```

### 5.3 記録
```typescript
interface CountRecord {
  id: string;                    // 記録ID（UUID）
  counterId: string;             // カウンターID
  counterName: string;           // カウンター名（記録時点のスナップショット）
  count: number;                 // カウント値（増減量、直接入力値）
  timestamp: string;             // ISO8601形式の日時
  tags: string[];                // タグIDの配列
  location?: {                   // 位置情報（オプション）
    latitude: number;
    longitude: number;
    address?: string;
  };
  deviceId: string;             // デバイスID
  inputMethod: 'button' | 'direct'; // 入力方法
}
```

### 5.4 ストレージ構造
```typescript
// AsyncStorageに保存されるデータ構造
{
  deviceId: string;
  tags: Tag[];
  counters: Counter[];
  records: CountRecord[];
}
```

## 6. 実装優先順位

### Phase 1: MVP（最小機能）
1. デバイスIDの自動生成と保存
2. タグの作成・管理機能
3. カウンターの作成・編集・削除
4. カウント操作（ボタン操作のみ）
5. 記録の保存（何を、いつ、タグ）
6. 当日登録中心のUI
7. 記録履歴の表示
8. 記録の編集・削除

### Phase 2: 入力方法の拡張
1. 直接入力機能（数値キーボード）
2. 入力方法の切り替えUI
3. 過去入力機能（日時ピッカー）

### Phase 3: 位置情報機能
1. 位置情報の取得許可リクエスト
2. 位置情報の記録（どこで）
3. 位置情報の表示

### Phase 4: 分析機能
1. タグ選択画面（頻度順表示）
2. カレンダー表示機能
3. 期間選択機能（プリセット・カスタム）
4. 統計情報の表示
5. グラフ表示（期間に応じた切り替え）

### Phase 5: 広告機能
1. AdMobの設定
2. 登録完了時の広告表示
3. バナー広告の実装
4. 広告表示頻度の制御

### Phase 6: 拡張機能
1. 履歴の高度な検索・フィルタ
2. データのエクスポート/インポート
3. クラウド同期（オプション）

## 7. 非機能要件

### 7.1 パフォーマンス
- アプリ起動時間: 3秒以内
- カウント操作の応答時間: 100ms以内
- 履歴表示の読み込み時間: 1秒以内
- グラフ表示の読み込み時間: 1秒以内

### 7.2 データ保存
- ローカルストレージに永続化
- アプリ再起動後もデータが保持される
- データのバリデーション（必須項目のチェックなど）
- エラーハンドリング（保存失敗時の処理）

### 7.3 プライバシー
- 位置情報はユーザーの明示的な許可を得てから取得
- 位置情報の取得を拒否してもアプリは正常に動作
- デバイスIDは匿名で、個人を特定できない形式

### 7.4 プラットフォーム対応
- iOS対応
- Android対応
- Web対応（オプション）

## 8. 技術要件

### 8.1 フロントエンド
- **フレームワーク**: Expo（React Native）
- **言語**: TypeScript
- **状態管理**: React Context API
- **ローカルストレージ**: @react-native-async-storage/async-storage
- **位置情報**: expo-location
- **広告**: react-native-google-mobile-ads
- **日時ピッカー**: @react-native-community/datetimepicker
- **グラフ**: react-native-chart-kit または victory-native
- **カレンダー**: react-native-calendars

### 8.2 バックエンド（将来の拡張用）
- 現在はローカルストレージのみ使用
- 将来的なクラウド同期のためにAWSインフラを準備（オプション）

## 9. 制約事項

### 9.1 会員登録なしでの利用
- 認証フローは不要
- デバイス間でのデータ同期は不可（ローカルのみ）
- デバイスを変更した場合、データは引き継げない

### 9.2 データ保存
- ローカルストレージの容量制限に依存
- 大量の記録を保存する場合は、古い記録の削除機能が必要

## 10. 将来の拡張可能性

### 10.1 クラウド同期（オプション）
- デバイスIDベースの匿名認証
- DynamoDBへのデータ保存
- 複数デバイス間での同期

### 10.2 追加機能
- カウント目標の設定
- リマインダー機能
- データのエクスポート（CSV/JSON）
- テーマカスタマイズ
- ダークモード対応
