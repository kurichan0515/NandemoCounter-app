# なんでもカウンターアプリ 要件定義書

## 1. 概要

### 1.1 アプリの目的
ユーザーが何でも数えて記録できるシンプルなカウンターアプリ。会員登録なしで即座に利用開始できる。

### 1.2 主要機能
- タグ機能によるカテゴリ分類
- カウントの増減操作（ボタン操作・直接入力）
- カウント記録の保存（何を、いつ、どこで）
- 記録履歴の閲覧と分析
- 複数のカウンター管理
- 当日登録中心のUI（過去入力も可能）
- 広告表示機能

## 2. 機能要件

### 2.1 認証・ユーザー管理

#### 2.1.1 会員登録なしでの利用
- **必須要件**: アプリ起動時に即座に利用開始できる
- **実装方針**: 
  - デバイス固有のID（UUID）を自動生成してローカルに保存
  - 初回起動時にデバイスIDを生成し、以降はそのIDを使用
  - ユーザーは認証フローを経由せずに利用可能

#### 2.1.2 データの保存先
- **ローカル優先**: デバイス内のストレージ（AsyncStorage/Expo SecureStore）に保存
- **オプション**: 将来的にクラウド同期機能を追加する可能性を考慮した設計

### 2.2 タグ機能

#### 2.2.1 タグの作成・管理
- 複数のタグを作成可能
- タグに名前と色を設定可能
- タグの編集・削除機能
- タグの一覧表示

#### 2.2.2 タグの付与
- 1つのカウント記録に複数のタグを付与可能
- カウント登録時にタグを選択・追加できる
- 既存の記録にも後からタグを追加・削除可能

#### 2.2.3 タグによる分析
- タグごとの集計表示（いつ、何を、どれだけ）
- タグ別の統計情報（合計、平均、期間別集計）
- タグの組み合わせでの分析（複数タグが付いた記録の抽出）

### 2.3 カウント機能

#### 2.3.1 カウント入力方法
**2種類の入力方法を提供**:

1. **ボタン操作**
   - カウントの増加（+1）
   - カウントの減少（-1）
   - リセットボタン（0に戻す）

2. **直接入力**
   - 数値キーボードで直接数値を入力
   - 入力値の検証（負の値の扱いなど）
   - 入力確定ボタン

#### 2.3.2 カウンターの作成・管理
- 複数のカウンターを作成可能
- 各カウンターに名前を設定可能
- カウンターの編集・削除機能

### 2.4 記録機能

#### 2.4.1 記録する情報
各カウント操作時に以下の情報を記録：

1. **何を数えたか（What）**
   - カウンターの名前/タイトル
   - カウンターの説明（オプション）
   - 付与されたタグ（複数可）

2. **いつ数えたか（When）**
   - カウント操作の日時（タイムスタンプ）
   - 日付、時刻の両方を記録
   - 過去の日時も指定可能

3. **どこで数えたか（Where）**
   - GPS位置情報（オプション、許可時のみ）
   - 位置情報が取得できない場合は「位置情報なし」として記録

#### 2.4.2 記録の保存形式
```typescript
interface CountRecord {
  id: string;                    // 記録ID（UUID）
  counterId: string;             // カウンターID
  counterName: string;           // カウンター名（何を）
  count: number;                 // カウント値
  timestamp: string;             // ISO8601形式の日時（いつ）
  tags: string[];                // タグIDの配列
  location?: {                   // 位置情報（どこで、オプション）
    latitude: number;
    longitude: number;
    address?: string;            // 逆ジオコーディング結果（オプション）
  };
  deviceId: string;             // デバイスID
  inputMethod: 'button' | 'direct'; // 入力方法
}
```

#### 2.4.3 記録のタイミングとUI
- **当日登録中心のUI**: デフォルトで当日の日時が設定される
- **過去入力機能**: 日時を変更して過去の記録も入力可能
- カウント操作（+/-/直接入力）のたびに記録
- リセット操作時も記録（カウント0に戻したことを記録）

### 2.5 履歴閲覧機能

#### 2.5.1 記録履歴の表示
- カウンターごとの履歴一覧表示
- タグごとの履歴一覧表示
- 日時順（新しい順/古い順）でソート可能
- 日付ごとにグループ化表示

#### 2.5.2 履歴の詳細表示
- 記録日時
- カウント値
- 付与されたタグ（複数表示）
- 位置情報（取得済みの場合、地図表示も検討）

#### 2.5.3 履歴の検索・フィルタ
- 日付範囲でのフィルタ
- カウンター名での検索
- タグでのフィルタ（単一タグ・複数タグ）
- 位置情報でのフィルタ（オプション）

#### 2.5.4 タグによる分析機能
- **タグ選択機能**
  - タグ一覧から分析対象を選択
  - **頻度の高いタグを優先表示**
    - 記録に使用された回数が多い順にソート
    - 最近使用されたタグも考慮（重み付け）
    - ソートオプション：頻度順、名前順、作成日順
  - 複数タグの選択と比較分析
  - 選択状態の視覚的フィードバック

- **カレンダー表示**
  - 月間カレンダーで記録の可視化
  - 選択されたタグの記録がある日を視覚的に表示
  - 複数タグ選択時は色分け表示
  - 日付タップで詳細表示

- **期間選択**
  - 月累計、3か月、6か月、12か月のプリセット期間
  - カスタム期間選択機能

- **集計機能**
  - 選択されたタグごとの集計（合計、平均、回数）
  - 期間別の集計（日別、週別、月別）
  - タグの組み合わせ分析
  - 複数タグ選択時の比較集計

- **グラフ表示**
  - 選択されたタグに応じたグラフ表示
  - 期間に応じた最適なグラフ表示
  - 日別集計グラフ（棒グラフ）
  - 週別・月別集計グラフ（折れ線グラフ）
  - タグ別の色分け表示
  - 複数タグ選択時の比較表示
  - インタラクティブな操作（タップで詳細表示など）

### 2.6 広告機能

#### 2.6.1 広告の種類
1. **登録完了時の広告**
   - カウント記録を保存した際に表示
   - インタースティシャル広告またはリワード広告
   - スキップ可能（数秒後に閉じる）

2. **バナー広告**
   - アプリ内の適切な位置に常時表示
   - 画面下部または上部に配置
   - スクロール時も追従するかは検討

#### 2.6.2 広告の実装
- Expo AdMobまたはGoogle Mobile Ads SDKを使用
- 広告の表示頻度制御（過度な表示を避ける）
- プライバシーポリシーへの対応

### 2.7 UI/UX要件

#### 2.7.1 メイン画面（今日の記録）
- **当日登録中心のUI**
  - デフォルトで今日の日付が表示
  - カウンター一覧またはタグ一覧表示
  - 新しいカウント登録ボタン
  - 過去入力への切り替えボタン

#### 2.7.2 カウント登録画面
- **入力方法の選択**
  - ボタン操作モード（+/-ボタン）
  - 直接入力モード（数値キーボード）
  - モード切り替えボタン

- **日時設定**
  - デフォルト：現在の日時
  - 過去入力：日時ピッカーで変更可能

- **タグ選択**
  - タグの一覧から複数選択
  - 新規タグ作成ボタン

- **登録ボタン**
  - 登録完了時に広告表示

#### 2.7.3 カウンター詳細画面
- 大きなカウント表示
- 入力方法切り替え（ボタン/直接入力）
- +/-/リセットボタン（ボタンモード時）
- 数値入力フィールド（直接入力モード時）
- 履歴表示への遷移ボタン
- タグ分析への遷移ボタン

#### 2.7.4 履歴画面
- 記録一覧表示
- 各記録の詳細情報表示
- タグフィルタ機能

#### 2.7.5 タグ分析画面
- **タグ選択**
  - タグ一覧から分析対象のタグを選択
  - **頻度の高いタグを優先表示**
    - 記録に使用された回数が多い順に表示
    - 最近使用されたタグも優先表示（オプション）
    - 頻度順・名前順・作成日順でソート可能
  - 複数のタグを選択して比較分析可能
  - 選択されたタグのハイライト表示
  - タグの色で視覚的に識別

- **カレンダー表示**
  - 月間カレンダー表示
  - 選択されたタグの記録がある日をハイライト表示
  - 日付をタップしてその日の記録を表示
  - カレンダー上で期間を選択可能
  - 複数タグ選択時は色分け表示

- **期間選択**
  - 月累計（現在の月の1日から今日まで）
  - 3か月（過去3か月間）
  - 6か月（過去6か月間）
  - 12か月（過去12か月間）
  - カスタム期間選択（開始日・終了日を指定）

- **グラフ表示**
  - 選択されたタグに応じたグラフ表示
  - 期間選択に応じたグラフ表示
  - 日別集計グラフ（棒グラフ）
  - 週別集計グラフ（折れ線グラフ）
  - 月別集計グラフ（折れ線グラフ）
  - タグ別の色分け表示
  - 複数タグ選択時は比較表示
  - グラフのズーム・パン機能（オプション）

- **統計情報**
  - 選択期間の合計カウント
  - 平均カウント（日別平均）
  - 最大カウント日
  - 記録日数
  - 選択されたタグ別の集計情報
  - 複数タグ選択時は比較統計情報

## 3. 非機能要件

### 3.1 パフォーマンス
- アプリ起動時間: 3秒以内
- カウント操作の応答時間: 100ms以内
- 履歴表示の読み込み時間: 1秒以内

### 3.2 データ保存
- ローカルストレージに永続化
- アプリ再起動後もデータが保持される
- データのバックアップ・復元機能（オプション）

### 3.3 プライバシー
- 位置情報はユーザーの明示的な許可を得てから取得
- 位置情報の取得を拒否してもアプリは正常に動作
- デバイスIDは匿名で、個人を特定できない形式

### 3.4 プラットフォーム対応
- iOS対応
- Android対応
- Web対応（オプション）

## 4. 技術要件

### 4.1 フロントエンド
- **フレームワーク**: Expo（React Native）
- **言語**: TypeScript
- **状態管理**: React Context API / Zustand（検討）
- **ローカルストレージ**: Expo SecureStore / AsyncStorage
- **位置情報**: expo-location
- **広告**: expo-ads-admob または react-native-google-mobile-ads
- **日時ピッカー**: @react-native-community/datetimepicker
- **グラフ**: react-native-chart-kit または victory-native
- **カレンダー**: react-native-calendars または react-native-calendar-strip

### 4.2 バックエンド（将来の拡張用）
- 現在はローカルストレージのみ使用
- 将来的なクラウド同期のためにAWSインフラを準備（オプション）

### 4.3 データモデル

#### 4.3.1 タグ
```typescript
interface Tag {
  id: string;                    // タグID（UUID）
  name: string;                  // タグ名
  color: string;                 // タグの色（HEXコード）
  createdAt: string;             // 作成日時
  deviceId: string;             // デバイスID
}
```

#### 4.3.2 カウンター
```typescript
interface Counter {
  id: string;                    // カウンターID（UUID）
  name: string;                  // カウンター名
  description?: string;          // 説明（オプション）
  currentCount: number;          // 現在のカウント値
  createdAt: string;             // 作成日時
  updatedAt: string;             // 更新日時
  deviceId: string;             // デバイスID
}
```

#### 4.3.3 記録
```typescript
interface CountRecord {
  id: string;                    // 記録ID（UUID）
  counterId: string;             // カウンターID
  counterName: string;           // カウンター名（記録時点）
  count: number;                 // カウント値
  timestamp: string;             // ISO8601形式の日時
  tags: string[];                // タグIDの配列
  location?: {                   // 位置情報（オプション）
    latitude: number;
    longitude: number;
    address?: string;
  };
  deviceId: string;             // デバイスID
  inputMethod: 'button' | 'direct'; // 入力方法
}
```

## 5. 実装優先順位

### Phase 1: MVP（最小機能）
1. デバイスIDの自動生成と保存
2. タグの作成・管理機能
3. カウンターの作成・削除
4. カウント操作（ボタン操作）
5. 記録の保存（何を、いつ、タグ）
6. 当日登録中心のUI
7. 記録履歴の表示

### Phase 2: 入力方法の拡張
1. 直接入力機能（数値キーボード）
2. 入力方法の切り替えUI
3. 過去入力機能（日時ピッカー）

### Phase 3: 位置情報機能
1. 位置情報の取得許可リクエスト
2. 位置情報の記録（どこで）
3. 位置情報の表示

### Phase 4: 分析機能
1. カレンダー表示機能
   - 月間カレンダーの実装
   - 記録日のハイライト表示
   - 日付タップで詳細表示
2. 期間選択機能
   - プリセット期間（月累計、3か月、6か月、12か月）
   - カスタム期間選択
3. タグによる分析機能
4. 統計情報の表示
5. グラフ表示
   - 期間に応じたグラフの切り替え
   - 日別・週別・月別の集計グラフ

### Phase 5: 広告機能
1. AdMobの設定
2. 登録完了時の広告表示
3. バナー広告の実装
4. 広告表示頻度の制御

### Phase 6: 拡張機能
1. 履歴の検索・フィルタ（高度な検索）
2. データのエクスポート/インポート
3. クラウド同期（オプション）

## 6. 制約事項

### 6.1 会員登録なしでの利用
- 認証フローは不要
- デバイス間でのデータ同期は不可（ローカルのみ）
- デバイスを変更した場合、データは引き継げない

### 6.2 データ保存
- ローカルストレージの容量制限に依存
- 大量の記録を保存する場合は、古い記録の削除機能が必要

## 7. 将来の拡張可能性

### 7.1 クラウド同期（オプション）
- デバイスIDベースの匿名認証
- DynamoDBへのデータ保存
- 複数デバイス間での同期

### 7.2 追加機能
- カウント目標の設定
- リマインダー機能
- データのエクスポート（CSV/JSON）
- テーマカスタマイズ
- ダークモード対応

## 8. 用語定義

- **カウンター**: 数を数えるための単位。例：「コーヒーを飲んだ回数」「歩数」など
- **タグ**: カウント記録を分類するためのラベル。1つの記録に複数のタグを付与可能
- **記録**: カウント操作のたびに保存される履歴データ
- **デバイスID**: アプリが自動生成するデバイス固有の識別子
- **当日登録**: デフォルトで当日の日時が設定される登録方法
- **過去入力**: 日時を変更して過去の日付で記録を入力する機能
